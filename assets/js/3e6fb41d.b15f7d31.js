"use strict";(self.webpackChunksleepy_discord_docs=self.webpackChunksleepy_discord_docs||[]).push([[5411],{3905:function(e,t,n){n.d(t,{Zo:function(){return d},kt:function(){return m}});var s=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,s)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,s,r=function(e,t){if(null==e)return{};var n,s,r={},a=Object.keys(e);for(s=0;s<a.length;s++)n=a[s],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(s=0;s<a.length;s++)n=a[s],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var i=s.createContext({}),c=function(e){var t=s.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},d=function(e){var t=c(e.components);return s.createElement(i.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return s.createElement(s.Fragment,{},t)}},p=s.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,i=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),p=c(n),m=r,g=p["".concat(i,".").concat(m)]||p[m]||u[m]||a;return n?s.createElement(g,o(o({ref:t},d),{},{components:n})):s.createElement(g,o({ref:t},d))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,o=new Array(a);o[0]=p;var l={};for(var i in t)hasOwnProperty.call(t,i)&&(l[i]=t[i]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var c=2;c<a;c++)o[c]=n[c];return s.createElement.apply(null,o)}return s.createElement.apply(null,n)}p.displayName="MDXCreateElement"},9783:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return l},contentTitle:function(){return i},metadata:function(){return c},toc:function(){return d},default:function(){return p}});var s=n(3117),r=n(102),a=(n(7294),n(3905)),o=["components"],l={title:"Requests"},i=void 0,c={unversionedId:"requests",id:"requests",title:"Requests",description:"Request allow you to send and get data by requesting Discord to do something. The upside that is that it's often simple to have Discord do stuff for you, but the downside is dealing with rate limits, waiting for a response, and error handling. Sleepy Discord changes how it handles these issues with different modes.",source:"@site/docs/requests.md",sourceDirName:".",slug:"/requests",permalink:"/sleepy-discord/docs/requests",tags:[],version:"current",lastUpdatedAt:1698528022,formattedLastUpdatedAt:"10/28/2023",frontMatter:{title:"Requests"},sidebar:"Docs",previous:{title:"Events",permalink:"/sleepy-discord/docs/events"},next:{title:"Voice",permalink:"/sleepy-discord/docs/voice"}},d=[{value:"Request Mode",id:"request-mode",children:[{value:"Async",id:"async",children:[],level:3},{value:"Sync",id:"sync",children:[],level:3},{value:"Combining Modes Together",id:"combining-modes-together",children:[],level:3},{value:"Setting a default Request Mode",id:"setting-a-default-request-mode",children:[],level:3}],level:2},{value:"Rate limited Request",id:"rate-limited-request",children:[{value:"AsyncQueue ON",id:"asyncqueue-on",children:[],level:3},{value:"AsyncQueue OFF",id:"asyncqueue-off",children:[],level:3}],level:2},{value:"Casting",id:"casting",children:[{value:"Implicit casting",id:"implicit-casting",children:[],level:3},{value:"Output Parameter Reference",id:"output-parameter-reference",children:[],level:3},{value:"Returned from cast function",id:"returned-from-cast-function",children:[],level:3},{value:"Arrays",id:"arrays",children:[],level:3}],level:2},{value:"Handling Error Responses",id:"handling-error-responses",children:[{value:"Try Catch",id:"try-catch",children:[],level:3},{value:"If Error",id:"if-error",children:[],level:3},{value:"Cast Returns bool",id:"cast-returns-bool",children:[],level:3}],level:2}],u={toc:d};function p(e){var t=e.components,n=(0,r.Z)(e,o);return(0,a.kt)("wrapper",(0,s.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Request allow you to send and get data by requesting Discord to do something. The upside that is that it's often simple to have Discord do stuff for you, but the downside is dealing with rate limits, waiting for a response, and error handling. Sleepy Discord changes how it handles these issues with different modes."),(0,a.kt)("h1",{id:"request-settings"},"Request Settings"),(0,a.kt)("h2",{id:"request-mode"},"Request Mode"),(0,a.kt)("p",null,"Request changes how the library handles the request. Mode is a enum and calculated using bitwise operations. For all available modes, you can find them in ",(0,a.kt)("a",{parentName:"p",href:"/docs/reference/Files/client_8h#enum-requestmode"},"the header file client.h"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-cpp"},"sendMessage(sendMessageParams, SleepyDiscord::Async);\n")),(0,a.kt)("h3",{id:"async"},"Async"),(0,a.kt)("p",null,"Does the request later, often on another thread. Useful for keeping your bot busy by not stopping a thread to wait for a response or a 2nd chance after a failed request."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-cpp"},"sendMessage(sendMessageParams, { SleepyDiscord::Async,\n    [](SleepyDiscord::ObjectResponse<SleepyDiscord::Message> res) {\n        SleepyDiscord::Message message;\n        if (!res.cast(message))\n            return; //error\n    }\n});\n")),(0,a.kt)("p",null,"Async requests should return an empty response right after being called."),(0,a.kt)("h3",{id:"sync"},"Sync"),(0,a.kt)("p",null,"Does the request when the function is called. Simpler then Async but with downsides of blocking the thread."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-cpp"},"try {\n    sendMessage(sendMessageParams, SleepyDiscord::Sync);\n} catch (SleepyDiscord::ErrorCode code) {\n    //error\n}\n")),(0,a.kt)("h3",{id:"combining-modes-together"},"Combining Modes Together"),(0,a.kt)("p",null,"You can use bitwise operators to fine tune the setting you want for a request. For example, if you don't want to use throw for error checking on an Sync request, take a look at the example."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-cpp"},"auto mode = SleepyDiscord::RequestMode(SleepyDiscord::Sync & ~(SleepyDiscord::ThrowError));\nSleepyDiscord::Message message;\nif (sendMessage(params, mode).cast(message)) {\n    //success\n} else {\n    //error\n}\n")),(0,a.kt)("p",null,"For all available modes, checkout the header file ",(0,a.kt)("inlineCode",{parentName:"p"},"client.h"),"."),(0,a.kt)("h3",{id:"setting-a-default-request-mode"},"Setting a default Request Mode"),(0,a.kt)("p",null,"You might not want to keep rewriting the request mode if you have a favorite. The library uses a Preprocessor Define that you can set in your build config or before including the library."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-cpp"},'#define SLEEPY_DEFAULT_REQUEST_MODE SleepyDiscord::Async\n#include "sleepy_discord/sleepy_discord.h"\n')),(0,a.kt)("h2",{id:"rate-limited-request"},"Rate limited Request"),(0,a.kt)("p",null,"The Library will handle Rate Limits for you but different modes and modules will give you different behaviors to your code."),(0,a.kt)("h3",{id:"asyncqueue-on"},"AsyncQueue ON"),(0,a.kt)("p",null,"When rate limited, this makes the request async and will do the request when the rate limit is lifted. This is a flag that set to ON on both ",(0,a.kt)("inlineCode",{parentName:"p"},"Async")," and the default, ",(0,a.kt)("inlineCode",{parentName:"p"},"Sync_AsyncQueue"),"."),(0,a.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,a.kt)("div",{parentName:"div",className:"admonition-heading"},(0,a.kt)("h5",{parentName:"div"},(0,a.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,a.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,a.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,a.kt)("div",{parentName:"div",className:"admonition-content"},(0,a.kt)("p",{parentName:"div"},"When doing more then one request, after the rate limit is lifted, the requests will be done out of order."))),(0,a.kt)("h3",{id:"asyncqueue-off"},"AsyncQueue OFF"),(0,a.kt)("p",null,"When rate limited, it'll return a error response."),(0,a.kt)("h1",{id:"responses"},"Responses"),(0,a.kt)("p",null,"After making a request, a response object is returned. This can be an error, a object, an array, or a boolean."),(0,a.kt)("h2",{id:"casting"},"Casting"),(0,a.kt)("p",null,"After a successful request, you'll want to get your data. There's multiple ways to do this."),(0,a.kt)("h3",{id:"implicit-casting"},"Implicit casting"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"SleepyDiscord::Message message = sendMessage(params);\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-cpp"},"auto messageResponse = sendMessage(params);\nSleepyDiscord::Message message = messageResponse;\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-cpp"},"SleepyDiscord::ObjectResponse<SleepyDiscord::Message> messageResponse = sendMessage(params);\nMessage message = messageResponse;\n")),(0,a.kt)("p",null,"For Objects, Booleans, and Strings"),(0,a.kt)("h3",{id:"output-parameter-reference"},"Output Parameter Reference"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-cpp"},"SleepyDiscord::Message message;\nsendMessage(params).cast(message);\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-cpp"},"if (sendMessage(params).cast(message))\n    //successful cast\n")),(0,a.kt)("p",null,"For Objects and returns true on success, could prevent a crash."),(0,a.kt)("h3",{id:"returned-from-cast-function"},"Returned from cast function"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-cpp"},"SleepyDiscord::Message message = sendMessage(params).cast();\n")),(0,a.kt)("p",null,"For Objects and Booleans"),(0,a.kt)("h3",{id:"arrays"},"Arrays"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-cpp"},"std::vector<SleepyDiscord::Message> messages;\ngetMessages().get(messages);\n")),(0,a.kt)("p",null,"For any container that returns iterators with ",(0,a.kt)("inlineCode",{parentName:"p"},".begin()")," and ",(0,a.kt)("inlineCode",{parentName:"p"},".end()")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-cpp"},"messages = getMessages();\n")),(0,a.kt)("p",null,"For std::list and std::vector"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-cpp"},"messages = getMessages().vector();\n")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},".list()")," for returning a std::list"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-cpp"},"getMessages().get<std::vector<SleepyDiscord::Message>>(message);\ngetMessages().get<std::vector>(messages);\n")),(0,a.kt)("p",null,"Same as the first ",(0,a.kt)("inlineCode",{parentName:"p"},".get()")," from before but with a template, when the compiler isn't sure which type to use."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-cpp"},"messages = getMessages().get<std::vector<SleepyDiscord::Message>>();\nmessages = getMessages().get<std::vector>();\n")),(0,a.kt)("h2",{id:"handling-error-responses"},"Handling Error Responses"),(0,a.kt)("p",null,"Sometimes an error is given, here are examples that should detect them."),(0,a.kt)("h3",{id:"try-catch"},"Try Catch"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-cpp"},"try {\n    sendMessage(sendMessageParams);\n} catch (SleepyDiscord::ErrorCode code) {\n    //error\n}\n")),(0,a.kt)("p",null,"This requires the Mode to have the ",(0,a.kt)("inlineCode",{parentName:"p"},"ThrowError")," flag set, which is set by the default Mode."),(0,a.kt)("h3",{id:"if-error"},"If Error"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-cpp"},"if (sendMessage(params).error())\n    //error\n")),(0,a.kt)("p",null,"Works on response type. Returns true on error."),(0,a.kt)("h3",{id:"cast-returns-bool"},"Cast Returns bool"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-cpp"},"if (deleteMessage(channelID, messageID).cast())\n    //success\nelse\n    //error\n")),(0,a.kt)("p",null,"This will depend on the request and only when a ",(0,a.kt)("inlineCode",{parentName:"p"},"BoolResponse")," is returned. If you don't want any throws during the request, ",(0,a.kt)("inlineCode",{parentName:"p"},"ThrowError")," flag in the ",(0,a.kt)("inlineCode",{parentName:"p"},"RequestMode")," needs to be disabled. Checkout ",(0,a.kt)("a",{parentName:"p",href:"#async"},"Async")," and ",(0,a.kt)("a",{parentName:"p",href:"#combining-modes-together"},"Combining Modes Together")," for examples."))}p.isMDXComponent=!0}}]);